<?php
/** @file
 *
 *  This is used to begin the streaming output of import results.
 *  The incoming view parameters should be:
 *      state       The current processing state
 *
 *  In-stream output is generated by:
 *      post-bookmarks-import-stream-begin.phtml        // Begin the stream
 *      post-bookmarks-import-stream-bookmark.phtml     // valid bookmark
 *      post-bookmarks-import-stream-error.phtml        // import error
 *      post-bookmarks-import-stream-warning.phtml      // import warning
 *
 *  The stream is ended with:
 *      post-bookmarks-import.phtml                     // Final results
 */

$tagStr     = implode(', ', $this->state['tagStack']);
$tagLabel   = 'tag' .(count($this->state['tagStack']) > 1 ? 's' : '');

$test       = ($this->state['test'] === 'yes'
                ? 'Testing '
                : '');
$visibility = $this->state['visibility'];
$conflict   = ($this->state['conflict'] === 'replace'
                ? 'replacing'
                : 'keeping');

$links = $this->headLink();
$links->appendStylesheet($this->baseUrl('/css/settings.css'))
      ->appendStylesheet($this->baseUrl('/css/bookmarks.css'));

$this->headTitle("Import");

/* Include the base-header information directly.
 *
 * Since layouts have been disabled, we must explicitly include these.
 */
echo $this->render('base-header.phtml');

?>
<div id='bookmark-import'>
 <h3><?= $test ?>Import of bookmarks using default <?= $tagLabel ?>
        <span class='tags'><?= $tagStr ?></span>,
    default visibility of
        <span class='privacy <?= $visibility ?>'><?= $visibility ?></span>,
    <?= $conflict ?> existing bookmarks.</h3>
 <div class='import-status'>
  <table>
   <thead>
    <tr>
     <th>lines</th><td id='line-count'>0</td>
     <th colspan='2'>imported</th>
     <th rowspan='2'>ignored</th>
     <th rowspan='2'>errors</th>
     <th rowspan='2'>warnings</th>
    </tr>
    <tr>
     <th>folders</th><td id='folder-count'>0</td>
     <th>new</th>
     <th>updated</th>
    </tr>
   </thead>
   <tbody>
    <tr>
     <th>bookmarks</th>
     <td id='bookmarks-count'>0</td>
     <td id='bookmarks-new'>0</td>
     <td id='bookmarks-updated'>0</td>
     <td id='bookmarks-ignored'>0</td>
     <td id='bookmarks-error'>0</td>
     <td id='bookmarks-warning'>0</td>
    </tr>
    <tr>
     <td colspan='7'>
      <div id='progressbar'></div>
     </td>
    </tr>
   </tbody>
  </table>
 </div>
 <script type='text/javascript'>
(function($) {
    var $status = $('#bookmark-import .import-status');
    var $stats  = {
        progress:           $status.find('#progressbar').progressbar(),
        lineCount:          $status.find('#line-count'),
        folderCount:        $status.find('#folder-count'),
        bookmarksCount:     $status.find('#bookmarks-count'),
        bookmarksNew:       $status.find('#bookmarks-new'),
        bookmarksUpdated:   $status.find('#bookmarks-updated'),
        bookmarksIgnored:   $status.find('#bookmarks-ignored'),
        bookmarksError:     $status.find('#bookmarks-error'),
        bookmarksWarning:   $status.find('#bookmarks-warning')
    };

    $.bookmarksImport_update = function( state ) {
        /*
            <td id='line-count'>0</td>
            <td id='folder-count'>0</td>
            <td id='bookmarks-count'>0</td>
            <td id='bookmarks-new'>0</td>
            <td id='bookmarks-updated'>0</td>
            <td id='bookmarks-ignored'>0</td>
            <td id='bookmarks-error'>0</td>
            <td id='bookmarks-warning'>0</td>
         */
        var complete    = (state.filePos / state.fileSize) * 100;
        $stats.progress.progressbar('value', complete);

        $stats.lineCount.text(state.lineNum);
        $stats.folderCount.text(state.numFolders);
        $stats.bookmarksCount.text(state.numBookmarks);
        $stats.bookmarksNew.text(state.numNew);
        $stats.bookmarksUpdated.text(state.numUpdated);
        $stats.bookmarksIgnored.text(state.numIgnored);
        $stats.bookmarksError.text(state.numErrors);
        $stats.bookmarksWarning.text(state.numWarnings);
    };
}(jQuery));
 </script>
 <ul class='items bookmarks'>
