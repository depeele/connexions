(function(a){a.widget("ui.optionGroups",{version:"0.1.1",options:{namespace:null,form:null},_create:function(){var b=this;var g=this.options;if(g.namespace===null){var e=b.element.data("namespace");if(e!==undefined){g.namespace=e}else{var d=b.element.attr("class");e=d.replace(/^(?:.* )?(.*?)OptionGroups(?: .*)?$/,"$1");if((e!==undefined)&&(e.length>0)){g.namespace=e}}}if(g.form===null){var f=b.element.data("form");if(f!==undefined){g.form=f}else{g.form=b.element.closest("form")}}var c=b.element.find("ul.groups");c.find("li").removeClass("ui-state-active");c.find(":checked").parent().addClass("ui-state-active");c.find(":radio").hide();c.find("li:not(.isCustom)").addClass("toggle");c.find("li.isCustom").addClass("control ui-corner-all ui-state-default").append("<div class='ui-icon ui-icon-triangle-1-s'>&nbsp;</div>");c.find("li:not(:last)").after("<span class='comma'>,</span>");b.element.find("input").addClass("ui-corner-all ui-state-default");b._bindEvents();if(!c.find("li.ui-state-active").hasClass("isCustom")){b.toggleFieldset()}},_bindEvents:function(){var j=this;var g=j.element.find("ul.groups");var f=j.element.find("fieldset:first");var b=g.find(".control:first");var e=function(k){k.preventDefault()};var h=function(k){k.preventDefault();k.stopPropagation();j.toggleFieldset()};var c=function(l){l.preventDefault();l.stopPropagation();var k=b.find(":radio");j.setGroup(k.val());return false};var d=function(l){l.preventDefault();l.stopPropagation();var k=a(this).find(":radio");j.setGroup(k.val())};var i=function(k){f.find(":checkbox").each(function(){a.log("Remove Cookie: name[ %s ] / [ %s ]",this.name,a(this).attr("name"));a.cookie(a(this).attr("name"),null)});if(!g.find("li.ui-state-active").hasClass("isCustom")){f.find(":checkbox").attr("disabled",true)}};b.bind("click.uioptiongroups",h);f.bind("change.uioptiongroups",c);g.find("li:not(.control)").bind("change.uioptiongroups",d).bind("click.uioptiongroups",d);j.options.form.bind("submit.uioptiongroups",i)},getGroup:function(){return this.element.find("ul.groups :checked").val()},setGroup:function(i){var b=this;var c=b.element.find("ul.groups");var g=b.element.find("fieldset:first");var f=c.find(":radio[value="+i+"]");if(f.length!==1){return}c.find(":checked").attr("checked",false).removeAttr("checked");f.attr("checked","checked");c.find("li.ui-state-active").removeClass("ui-state-active");f.parent().addClass("ui-state-active");if(!f.parent().hasClass("control")){g.find("input").removeAttr("checked");g.find(".inGroup-"+i).attr("checked","checked")}var e=[];var h=[];g.find("input:checked").each(function(){e.push("."+a(this).attr("name").replace(/^.*?\[(.*?)\]$/,"$1").replace(/:/g," ."))});g.find("input:not(:checked)").each(function(){h.push("."+a(this).attr("name").replace(/^.*?\[(.*?)\]$/,"$1").replace(/:/g," ."))});var d={group:i,selected:e,deSelected:h};b.element.data("groupInfo",d);b.options.form.trigger("change",d)},getGroupInfo:function(){return this.element.data("groupInfo")},enable:function(){this.find(":input").removeAttr("disabled")},disable:function(){this.find(":input").attr("disabled",true)},toggleFieldset:function(){this.element.find("fieldset:first").toggleClass("ui-state-active").toggle()},destroy:function(){var c=this;c.element.find("a.option,div.option a:first").removeData("group");var d=c.element.find(".control:first");var b=c.element.find("input[name="+c.options.namespace+"Group]");d.unbind(".uioptiongroups");d.find("> a, .control > a, .control > .ui-icon").unbind(".uioptiongroups");c.element.find("fieldset:first").unbind(".uioptiongroups");c.element.find("a.option").unbind(".uioptiongroups");c.options.form.unbind(".uioptiongroups")}})}(jQuery));